# 08. æœ€ä½³å®è·µ

## ç›®å½•
- [8.1 æ¶æ„è®¾è®¡æœ€ä½³å®è·µ](#81-æ¶æ„è®¾è®¡æœ€ä½³å®è·µ)
- [8.2 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#82-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
- [8.3 å¯é æ€§å’Œè°ƒè¯•](#83-å¯é æ€§å’Œè°ƒè¯•)
- [8.4 å›¢é˜Ÿåä½œ](#84-å›¢é˜Ÿåä½œ)
- [8.5 å®‰å…¨æ€§](#85-å®‰å…¨æ€§)

---

## 8.1 æ¶æ„è®¾è®¡æœ€ä½³å®è·µ

### 1. æƒé™è®¾è®¡åŸåˆ™

```
æœ€å°æƒé™åŸåˆ™å®è·µ:

âœ… æ¨èåšæ³•:

1. åˆ†å±‚æƒé™
   å¼€å‘ç¯å¢ƒ: --accepting-edits
   â””â”€ å…è®¸æ–‡ä»¶ä¿®æ”¹
   â””â”€ Bash å‘½ä»¤éœ€ç¡®è®¤

   æµ‹è¯•ç¯å¢ƒ: --yes (YOLO)
   â””â”€ å¿«é€Ÿè¿­ä»£
   â””â”€ éš”ç¦»ç¯å¢ƒå®‰å…¨

   ç”Ÿäº§ç¯å¢ƒ: default + plan mode
   â””â”€ æ‰€æœ‰æ“ä½œéœ€å®¡æ‰¹
   â””â”€ å¼ºåˆ¶ /plan æµç¨‹

2. é¡¹ç›®é…ç½®
   .claude/config.json:
   {
     "permissions": {
       "allow": [
         "Bash(npm run *)",      // å…è®¸ npm scripts
         "Bash(git commit *)"    // å…è®¸æäº¤
       ],
       "deny": [
         "Bash(rm -rf *)",       // ç¦æ­¢å±é™©åˆ é™¤
         "Bash(git push --force*)"  // ç¦æ­¢å¼ºåˆ¶æ¨é€
       ],
       "ask": [
         "Bash(git push *)",     // æ¨é€éœ€ç¡®è®¤
         "File(package.json)"    // ä¿®æ”¹ä¾èµ–éœ€ç¡®è®¤
       ]
     }
   }

3. Hook è¾…åŠ©éªŒè¯
   PreBashRun:
     â””â”€ å±é™©å‘½ä»¤æ‹¦æˆª
     â””â”€ å‚æ•°æ³¨å…¥æ£€æµ‹
     â””â”€ å®¡è®¡æ—¥å¿—

âŒ é¿å…:

1. åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ YOLO æ¨¡å¼
   é£é™©: æ„å¤–ç ´åç”Ÿäº§æ•°æ®

2. è¿‡åº¦é™åˆ¶æƒé™
   é—®é¢˜: å½±å“å¼€å‘æ•ˆç‡
   å¹³è¡¡: ä½¿ç”¨ accepting-edits ä½œä¸ºé»˜è®¤

3. å¿½ç•¥å®¡è®¡æ—¥å¿—
   é—®é¢˜: æ— æ³•è¿½è¸ªé—®é¢˜æ¥æº
   è§£å†³: å¯ç”¨ PostBashRun hook
```

### 2. ä»»åŠ¡åˆ†è§£ç­–ç•¥

```
å¤§ä»»åŠ¡åˆ†è§£æœ€ä½³å®è·µ:

âœ… æ¨èæ¨¡å¼:

1. å‚ç›´åˆ‡åˆ† (æŒ‰åŠŸèƒ½)
   ç”µå•†ç»“è´¦æµç¨‹:
   â”œâ”€ Task 1: è´­ç‰©è½¦ç³»ç»Ÿ (ç‹¬ç«‹)
   â”œâ”€ Task 2: è®¢å•ç³»ç»Ÿ (ç‹¬ç«‹)
   â”œâ”€ Task 3: æ”¯ä»˜é›†æˆ (ç‹¬ç«‹)
   â””â”€ Task 4: é›†æˆæ‰€æœ‰æ¨¡å— (ä¾èµ– 1-3)

   ä¼˜åŠ¿:
   âœ“ å¯å¹¶è¡Œå¼€å‘ (Tasks 1-3)
   âœ“ æ¸…æ™°çš„èŒè´£è¾¹ç•Œ
   âœ“ æ˜“äºæµ‹è¯•

2. æ°´å¹³åˆ‡åˆ† (æŒ‰å±‚æ¬¡)
   å®ç°æ–°åŠŸèƒ½:
   â”œâ”€ Task 1: æ•°æ®å±‚ (Schema + è¿ç§»)
   â”œâ”€ Task 2: API å±‚ (ä¾èµ– Task 1)
   â”œâ”€ Task 3: UI å±‚ (ä¾èµ– Task 2)
   â””â”€ Task 4: æµ‹è¯• (ä¾èµ– Task 3)

   ä¼˜åŠ¿:
   âœ“ è‡ªåº•å‘ä¸Šæ„å»º
   âœ“ æ¯å±‚ç‹¬ç«‹æµ‹è¯•
   âœ“ æ¸…æ™°çš„ä¾èµ–å…³ç³»

3. å¢é‡å¼åˆ‡åˆ†
   å¤§å‹é‡æ„:
   â”œâ”€ Task 1: é‡æ„ 10% æ¨¡å— (è¯•ç‚¹)
   â”œâ”€ Task 2: é‡æ„ 30% æ¨¡å— (ä¾èµ– 1)
   â”œâ”€ Task 3: é‡æ„ 60% æ¨¡å— (ä¾èµ– 2)
   â””â”€ Task 4: å®Œæˆå‰©ä½™ (ä¾èµ– 3)

   ä¼˜åŠ¿:
   âœ“ é€æ­¥éªŒè¯æ–¹æ¡ˆ
   âœ“ æ—©æœŸå‘ç°é—®é¢˜
   âœ“ å¯éšæ—¶åœæ­¢æˆ–è°ƒæ•´

âŒ é¿å…:

1. å•ä¸€å·¨å‹ä»»åŠ¡
   é—®é¢˜:
   - æ— æ³•å¹¶è¡Œ
   - éš¾ä»¥è¿½è¸ªè¿›åº¦
   - å¤±è´¥å½±å“å¤§

   é”™è¯¯ç¤ºä¾‹:
   Task 1: å®ç°æ•´ä¸ªç”µå•†ç³»ç»Ÿ (ä¼°æ—¶: 200h)

   æ”¹è¿›:
   æ‹†åˆ†ä¸º 20+ ä¸ªå°ä»»åŠ¡ï¼Œæ¯ä¸ª 5-10h

2. è¿‡åº¦ç»†åˆ†
   é—®é¢˜:
   - ä»»åŠ¡å¼€é”€å¤§
   - åè°ƒå¤æ‚
   - ä¸Šä¸‹æ–‡åˆ‡æ¢é¢‘ç¹

   é”™è¯¯ç¤ºä¾‹:
   Task 1: å†™å‡½æ•°ç­¾å
   Task 2: å†™å‡½æ•°ä½“ç¬¬1è¡Œ
   Task 3: å†™å‡½æ•°ä½“ç¬¬2è¡Œ
   ...

   æ”¹è¿›:
   Task 1: å®ç°å®Œæ•´çš„å‡½æ•° (åŒ…å«æµ‹è¯•)

3. å¾ªç¯ä¾èµ–
   é—®é¢˜:
   - æ­»é”
   - æ— æ³•è°ƒåº¦

   é”™è¯¯ç¤ºä¾‹:
   Task 1 ä¾èµ– Task 2
   Task 2 ä¾èµ– Task 1

   æ”¹è¿›:
   é‡æ–°è®¾è®¡ä»»åŠ¡è¾¹ç•Œ
```

### 3. ä¸Šä¸‹æ–‡ç®¡ç†ç­–ç•¥

```
é«˜æ•ˆä¸Šä¸‹æ–‡ç®¡ç†:

âœ… æ¨èåšæ³•:

1. ä¸»åŠ¨å‹ç¼©
   æ—¶æœº:
   - å®Œæˆé‡å¤§é‡Œç¨‹ç¢‘å
   - åˆ‡æ¢ä»»åŠ¡å‰
   - æ¯å¤©å¼€å§‹å·¥ä½œå‰

   å‘½ä»¤: /compact

   æ•ˆæœ:
   - é‡Šæ”¾ token ç©ºé—´
   - ä¿ç•™å…³é”®ä¿¡æ¯
   - æå‡å“åº”è´¨é‡

2. ç»“æ„åŒ–é¡¹ç›®ä¸Šä¸‹æ–‡
   CLAUDE.md æ¨¡æ¿:

   ```markdown
   # é¡¹ç›®ä¸Šä¸‹æ–‡

   ## æŠ€æœ¯æ ˆ
   - å‰ç«¯: React 18 + TypeScript + Tailwind
   - åç«¯: Node.js 20 + Express
   - æ•°æ®åº“: PostgreSQL 15
   - éƒ¨ç½²: Docker + AWS

   ## æ¶æ„å†³ç­–è®°å½• (ADR)

   ### ADR-001: é€‰æ‹© JWT è®¤è¯
   - æ—¥æœŸ: 2026-02-01
   - å†³ç­–: ä½¿ç”¨ JWT è€Œé Session
   - åŸå› : éœ€è¦æ”¯æŒç§»åŠ¨ APPï¼Œæ— çŠ¶æ€æ›´é€‚åˆ
   - åæœ: éœ€è¦å®ç° token åˆ·æ–°æœºåˆ¶

   ### ADR-002: ä½¿ç”¨ Monorepo
   - æ—¥æœŸ: 2026-02-03
   - å†³ç­–: Nx + pnpm workspaces
   - åŸå› : å…±äº«ä»£ç ï¼Œç»Ÿä¸€ç‰ˆæœ¬ç®¡ç†
   - åæœ: æ„å»ºæ—¶é—´å¢åŠ ï¼Œéœ€è¦ä¼˜åŒ–

   ## ä»£ç è§„èŒƒ
   - ä½¿ç”¨ ESLint + Prettier
   - æäº¤å‰è‡ªåŠ¨è¿è¡Œ lint å’Œ test
   - æ‰€æœ‰ API å¿…é¡»æœ‰å•å…ƒæµ‹è¯•
   - æµ‹è¯•è¦†ç›–ç‡ >= 80%

   ## å¸¸è§é—®é¢˜ (FAQ)

   ### å¦‚ä½•è¿è¡Œæµ‹è¯•?
   ```bash
   npm test              # æ‰€æœ‰æµ‹è¯•
   npm run test:watch    # ç›‘æ§æ¨¡å¼
   npm run test:coverage # è¦†ç›–ç‡æŠ¥å‘Š
   ```

   ### æ•°æ®åº“è¿ç§»
   ```bash
   npm run migrate:up    # åº”ç”¨è¿ç§»
   npm run migrate:down  # å›æ»š
   npm run migrate:create name  # åˆ›å»ºæ–°è¿ç§»
   ```

   ## å¾…åŠäº‹é¡¹ (ä¼˜å…ˆçº§æ’åº)
   - [ ] ğŸ”´ ä¿®å¤ç™»å½•è¶…æ—¶é—®é¢˜
   - [ ] ğŸŸ¡ ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
   - [ ] ğŸŸ¢ æ·»åŠ ç”¨æˆ·ä»ªè¡¨æ¿
   ```

   ä¼˜åŠ¿:
   âœ“ å‡å°‘é‡å¤è¯´æ˜
   âœ“ æŒä¹…åŒ–é‡è¦å†³ç­–
   âœ“ æ–°æˆå‘˜å¿«é€Ÿä¸Šæ‰‹

3. åˆ©ç”¨ä»»åŠ¡ç³»ç»Ÿ
   é•¿æœŸé¡¹ç›®:
   â”œâ”€ åˆ›å»ºä»»åŠ¡åˆ—è¡¨
   â”œâ”€ è·¨ä¼šè¯æŒä¹…åŒ–
   â””â”€ å›¢é˜Ÿå…±äº«è¿›åº¦

   ç¯å¢ƒå˜é‡:
   export CLAUDE_CODE_TASK_LIST_ID=project-123

   å¤šäººåä½œ:
   æˆå‘˜ A å’Œ B å…±äº«ä»»åŠ¡åˆ—è¡¨
   å®æ—¶åŒæ­¥è¿›åº¦

âŒ é¿å…:

1. ä¸Šä¸‹æ–‡æ±¡æŸ“
   é—®é¢˜: ç´¯ç§¯æ— ç”¨ä¿¡æ¯

   ç¤ºä¾‹:
   - é‡å¤è¯»å–åŒä¸€æ–‡ä»¶
   - ä¿ç•™å¤±è´¥çš„å°è¯•å†å²
   - å†—ä½™çš„ä¸­é—´ç»“æœ

   è§£å†³: å®šæœŸ /compact

2. ç¼ºå°‘é¡¹ç›®æ–‡æ¡£
   é—®é¢˜: æ¯æ¬¡éƒ½è¦é‡æ–°è¯´æ˜

   ç¤ºä¾‹:
   User (æ¯æ¬¡): "é¡¹ç›®ä½¿ç”¨ JWT è®¤è¯ï¼Œtoken æœ‰æ•ˆæœŸ 24h..."

   è§£å†³: å†™å…¥ CLAUDE.md

3. å¿½ç•¥ä¼šè¯ç®¡ç†
   é—®é¢˜: ä¸¢å¤±å·¥ä½œè¿›åº¦

   ç¤ºä¾‹:
   Session 1 (å·¥ä½œ 3 å°æ—¶)
   â””â”€ ç›´æ¥å…³é—­ç»ˆç«¯
   â””â”€ æ‰€æœ‰è¿›åº¦ä¸¢å¤±

   è§£å†³:
   é€€å‡ºå‰: /export summary.md
   æˆ–: ä½¿ç”¨ --resume
```

---

## 8.2 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. Token é¢„ç®—ä¼˜åŒ–

```
Token ä½¿ç”¨ä¼˜åŒ–æŠ€å·§:

âœ… æ¨èåšæ³•:

1. Tool Search (å¦‚æœæœ‰å¤§é‡ MCP å·¥å…·)
   é…ç½®:
   {
     "toolSearch": {
       "enabled": true,
       "maxResults": 10
     }
   }

   æ•ˆæœ:
   èŠ‚çœ 40-50% çš„ token ç”¨é‡

2. ç²¾å‡†çš„æ–‡ä»¶å¼•ç”¨
   âŒ ä½æ•ˆ:
   "è¯·ä¿®æ”¹ auth.ts æ–‡ä»¶"
   â†’ Claude éœ€è¦è¯»å–æ•´ä¸ªæ–‡ä»¶

   âœ… é«˜æ•ˆ:
   "åœ¨ auth.ts:45-67 çš„ verifyToken å‡½æ•°ä¸­æ·»åŠ ..."
   â†’ Claude å¯ä»¥ç²¾å‡†å®šä½

3. æ‘˜è¦è€Œéè¯¦ç»†æ—¥å¿—
   âŒ ä½æ•ˆ:
   User: "è¿è¡Œæµ‹è¯•å¹¶ç»™æˆ‘æ‰€æœ‰è¾“å‡º"
   â†’ å¯èƒ½äº§ç”Ÿæ•°åƒè¡Œè¾“å‡º

   âœ… é«˜æ•ˆ:
   User: "è¿è¡Œæµ‹è¯•ï¼Œå¦‚æœå¤±è´¥å‘Šè¯‰æˆ‘é”™è¯¯æ‘˜è¦"
   â†’ Claude è‡ªåŠ¨è¿‡æ»¤å…³é”®ä¿¡æ¯

4. å¢é‡ä¸Šä¸‹æ–‡åŠ è½½
   ä½¿ç”¨åœºæ™¯: å¤§å‹ä»£ç åº“

   æ–¹æ³•:
   - å…ˆç”¨ Explore åˆ†æç»“æ„
   - åªè¯»å–å¿…è¦çš„æ–‡ä»¶
   - æŒ‰éœ€åŠ è½½ä¾èµ–

5. Context Compaction
   é…ç½®:
   {
     "context": {
       "autoCompact": true,
       "threshold": 0.85  // 85% æ—¶è§¦å‘
     }
   }

   æ‰‹åŠ¨è§¦å‘: /compact
```

### 2. å¹¶è¡Œæ‰§è¡Œä¼˜åŒ–

```
æœ€å¤§åŒ–å¹¶è¡Œæ•ˆç‡:

âœ… æ¨èæ¨¡å¼:

1. è¯†åˆ«ç‹¬ç«‹ä»»åŠ¡
   åˆ†æ:
   Task A: å‰ç«¯ UI
   Task B: åç«¯ API
   Task C: æ•°æ®åº“ Schema
   Task D: æ–‡æ¡£

   ä¾èµ–å…³ç³»:
   æ— ç›¸äº’ä¾èµ– â†’ å¯å®Œå…¨å¹¶è¡Œ

   æ‰§è¡Œ:
   åŒæ—¶å¯åŠ¨ 4 ä¸ª General Subagents
   é¢„è®¡æ—¶é—´: max(A, B, C, D) è€Œé A+B+C+D

2. æµæ°´çº¿å¹¶è¡Œ
   ç¤ºä¾‹: CI/CD æµç¨‹

   ä¸²è¡Œ (æ…¢):
   Lint â†’ Test â†’ Build â†’ Deploy
   æ€»æ—¶é—´: 5 + 10 + 8 + 3 = 26 åˆ†é’Ÿ

   å¹¶è¡Œ (å¿«):
   â”Œâ”€ Lint (5 min)    â”€â”
   â”œâ”€ Type Check (4 min)â”€â”¤
   â””â”€ Security (3 min)  â”€â”˜
            â†“ (5 min)
   â”Œâ”€ Unit Test (10 min)    â”€â”
   â”œâ”€ Integration Test (8 min)â”€â”¤
   â””â”€ E2E Test (12 min)        â”€â”˜
            â†“ (12 min)
        Build (8 min)
            â†“
        Deploy (3 min)

   æ€»æ—¶é—´: 5 + 12 + 8 + 3 = 28 åˆ†é’Ÿ... ç­‰ç­‰ï¼Ÿ

   æ›´å¥½çš„å¹¶è¡Œ:
   â”Œâ”€ Lint (5 min)    â”€â”
   â”œâ”€ Type Check (4 min)â”€â”¼â”€ Build (8 min)
   â”œâ”€ Unit Test (6 min) â”€â”¤      â†“
   â””â”€ Security (3 min)  â”€â”˜  Deploy (3 min)
   åŒæ—¶:
   â””â”€ Integration Test (12 minï¼Œåå°)

   æ€»æ—¶é—´: max(5, 4, 6, 3) + 8 + 3 = 17 åˆ†é’Ÿ
   èŠ‚çœ: 9 åˆ†é’Ÿ (35%)

3. åå°ä»»åŠ¡
   é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡æ”¾åå°:

   ç¤ºä¾‹:
   - å¼€å‘æœåŠ¡å™¨ (npm run dev)
   - æµ‹è¯•ç›‘æ§ (npm run test:watch)
   - æ—¥å¿—ç›‘æ§ (tail -f logs/app.log)

   æ“ä½œ: Ctrl+B ç§»åˆ°åå°

4. æ‰¹é‡æ“ä½œ
   ç¤ºä¾‹: è¿ç§» 100 ä¸ªç»„ä»¶

   âŒ ä½æ•ˆ:
   For each component:
     General Subagent: è¿ç§»ç»„ä»¶

   100 ä¸ªä¸²è¡Œä»»åŠ¡

   âœ… é«˜æ•ˆ:
   æ‰¹æ¬¡ 1: ç»„ä»¶ 1-15  â†’ General #1
   æ‰¹æ¬¡ 2: ç»„ä»¶ 16-30 â†’ General #2
   æ‰¹æ¬¡ 3: ç»„ä»¶ 31-45 â†’ General #3
   ...
   æ‰¹æ¬¡ 7: ç»„ä»¶ 91-100 â†’ General #7

   7 ä¸ªå¹¶è¡Œæ‰¹æ¬¡ï¼Œæ¯æ‰¹ 15 ä¸ª
   æé€Ÿ: ~14 å€

âŒ é¿å…:

1. è¿‡åº¦å¹¶è¡Œ
   é—®é¢˜: èµ„æºç«äº‰

   é”™è¯¯ç¤ºä¾‹:
   åŒæ—¶è¿è¡Œ 20 ä¸ª Subagent
   â†’ è¶…è¿‡ 7 ä¸ªé™åˆ¶
   â†’ éƒ¨åˆ†ç­‰å¾…
   â†’ å®é™…æ²¡æœ‰åŠ é€Ÿ

   è§£å†³: é™åˆ¶åœ¨ 7 ä¸ªä»¥å†…

2. å¿½ç•¥ä¾èµ–
   é—®é¢˜: é”™è¯¯çš„å¹¶è¡Œ

   é”™è¯¯ç¤ºä¾‹:
   å¹¶è¡Œ:
   - Task A: ä¿®æ”¹æ•°æ®åº“ Schema
   - Task B: ä½¿ç”¨æ–° Schema çš„ API

   ç»“æœ: Task B å¤±è´¥ (Schema è¿˜æ²¡å‡†å¤‡å¥½)

   è§£å†³: æ­£ç¡®è®¾ç½®ä¾èµ–
   Task B blockedBy: [Task A]

3. ç»†ç²’åº¦å¹¶è¡Œ
   é—®é¢˜: ä»»åŠ¡å¼€é”€ > æ”¶ç›Š

   é”™è¯¯ç¤ºä¾‹:
   Task 1: åˆ›å»ºæ–‡ä»¶ (1ç§’)
   Task 2: å†™å…¥ç¬¬1è¡Œ (1ç§’)
   Task 3: å†™å…¥ç¬¬2è¡Œ (1ç§’)

   æ¯ä¸ªä»»åŠ¡å¯åŠ¨å¼€é”€: 2ç§’
   æ€»æ—¶é—´: 3 * (1 + 2) = 9ç§’

   ä¸²è¡Œç›´æ¥å†™:
   æ€»æ—¶é—´: 3ç§’

   è§£å†³: åˆå¹¶ä¸ºå•ä¸ªä»»åŠ¡
```

### 3. ç¼“å­˜ç­–ç•¥

```
æ™ºèƒ½ç¼“å­˜ä½¿ç”¨:

âœ… æ¨èåšæ³•:

1. æ–‡ä»¶å†…å®¹ç¼“å­˜
   åœºæ™¯: é¢‘ç¹è¯»å–çš„æ–‡ä»¶

   å®ç° (Hook):
   {
     "PostFileRead": {
       "command": "cache-file {file} {content_hash}"
     },
     "PreFileRead": {
       "command": "check-cache {file}",
       "onHit": "skip_read"
     }
   }

2. å·¥å…·ç»“æœç¼“å­˜
   åœºæ™¯: å¹‚ç­‰çš„å·¥å…·è°ƒç”¨

   ç¤ºä¾‹:
   npm list  (åŒ…åˆ—è¡¨ä¸é¢‘ç¹å˜åŒ–)
   git log   (å†å²ä¸å˜)

   é…ç½®:
   {
     "cache": {
       "tools": {
         "Bash(npm list)": {
           "ttl": 3600,  // 1å°æ—¶
           "key": "package.json hash"
         }
       }
     }
   }

3. MCP å·¥å…·å“åº”ç¼“å­˜
   åœºæ™¯: å¤–éƒ¨ API è°ƒç”¨

   ç¤ºä¾‹:
   {
     "mcpServers": {
       "weather-api": {
         "cache": {
           "enabled": true,
           "ttl": 1800  // 30åˆ†é’Ÿ
         }
       }
     }
   }

4. è¯­ä¹‰ç¼“å­˜
   åœºæ™¯: ç±»ä¼¼çš„æŸ¥è¯¢

   ç¤ºä¾‹:
   Query 1: "æŸ¥è¯¢æ´»è·ƒç”¨æˆ·"
   Query 2: "åˆ—å‡ºæœ€è¿‘çš„ç”¨æˆ·"

   å¯èƒ½è¿”å›ç›¸åŒç»“æœ (å¦‚æœå®šä¹‰ç›¸ä¼¼)

   å®ç°: å‘é‡ç›¸ä¼¼åº¦åŒ¹é…
```

---

## 8.3 å¯é æ€§å’Œè°ƒè¯•

### 1. é”™è¯¯å¤„ç†

```
å¥å£®çš„é”™è¯¯å¤„ç†:

âœ… æ¨èåšæ³•:

1. Hook è‡ªåŠ¨é‡è¯•
   PreBashRun:
   {
     "pattern": "npm install",
     "onFailure": {
       "retry": {
         "count": 3,
         "delay": 5000,  // 5ç§’
         "backoff": "exponential"
       }
     }
   }

2. ä¼˜é›…é™çº§
   ç¤ºä¾‹: MCP å·¥å…·ä¸å¯ç”¨

   Fallback ç­–ç•¥:
   If MCP(database) fails:
     â†’ ä½¿ç”¨æœ¬åœ° SQLite
     â†’ æˆ–æç¤ºç”¨æˆ·æ‰‹åŠ¨æŸ¥è¯¢

3. è¯¦ç»†é”™è¯¯æ—¥å¿—
   PostToolUse Hook:
   {
     "command": "log-tool-error {tool} {error} {context}",
     "enabled_on_error": true
   }

4. å¥åº·æ£€æŸ¥
   OnSessionStart Hook:
   ```bash
   #!/bin/bash
   # check-environment.sh

   checks=(
     "node:node --version"
     "npm:npm --version"
     "git:git --version"
     "docker:docker --version"
   )

   for check in "${checks[@]}"; do
     IFS=: read name cmd <<< "$check"
     if ! $cmd &>/dev/null; then
       echo "âš ï¸  $name not found"
     fi
   done
   ```

5. è‡ªåŠ¨å›æ»š
   åœºæ™¯: éƒ¨ç½²å¤±è´¥

   ./scripts/deploy.sh:
   ```bash
   #!/bin/bash
   set -e

   # ä¿å­˜å½“å‰çŠ¶æ€
   ROLLBACK_TAG=$(git describe --tags)

   trap 'rollback $ROLLBACK_TAG' ERR

   # éƒ¨ç½²
   deploy_to_production

   # å¥åº·æ£€æŸ¥
   if ! health_check; then
     echo "å¥åº·æ£€æŸ¥å¤±è´¥ï¼Œå›æ»š..."
     rollback $ROLLBACK_TAG
   fi
   ```
```

### 2. æ—¥å¿—å’Œç›‘æ§

```
å…¨é¢çš„å¯è§‚æµ‹æ€§:

âœ… æ¨èåšæ³•:

1. ç»“æ„åŒ–æ—¥å¿—
   .claude/logs/session.log:
   ```json
   {
     "timestamp": "2026-02-08T10:30:00Z",
     "level": "info",
     "event": "tool_execution",
     "tool": "Bash",
     "command": "npm test",
     "duration": 12450,
     "exit_code": 0,
     "session_id": "sess_abc123"
   }
   ```

2. æ€§èƒ½ç›‘æ§
   Hook å®ç°:
   PostToolUse:
   ```bash
   #!/bin/bash
   TOOL=$1
   DURATION=$2

   # è®°å½•åˆ° InfluxDB
   curl -XPOST "http://localhost:8086/write?db=claude_metrics" \
     --data-binary "tool_duration,tool=$TOOL value=$DURATION"

   # æ£€æŸ¥é˜ˆå€¼
   if [ $DURATION -gt 10000 ]; then
     notify-slow-tool "$TOOL" "$DURATION"
   fi
   ```

3. å®¡è®¡è¿½è¸ª
   å®Œæ•´çš„å‘½ä»¤å®¡è®¡:
   PostBashRun:
   ```bash
   echo "$(date -Iseconds),${USER},${PWD},${COMMAND},${EXIT_CODE}" \
     >> .claude/audit.csv
   ```

4. å‘Šè­¦é€šçŸ¥
   ./scripts/alert.sh:
   ```bash
   #!/bin/bash
   EVENT=$1
   SEVERITY=$2
   MESSAGE=$3

   case $SEVERITY in
     critical)
       # PagerDuty
       trigger-pagerduty "$EVENT" "$MESSAGE"
       # Email
       send-email "ops@example.com" "$MESSAGE"
       # Slack
       notify-slack "#alerts" "ğŸ”´ $MESSAGE"
       ;;
     warning)
       notify-slack "#monitoring" "ğŸŸ¡ $MESSAGE"
       ;;
   esac
   ```
```

---

## 8.4 å›¢é˜Ÿåä½œ

### å›¢é˜Ÿæœ€ä½³å®è·µ

```
é«˜æ•ˆå›¢é˜Ÿåä½œ:

âœ… æ¨èåšæ³•:

1. å…±äº«é…ç½®
   é¡¹ç›®æ ¹ç›®å½•:
   .claude-config.json (æäº¤åˆ° Git)
   â”œâ”€ å›¢é˜Ÿå…±äº«çš„ MCP æœåŠ¡å™¨
   â”œâ”€ ç»Ÿä¸€çš„ Hook é…ç½®
   â””â”€ é¡¹ç›®çº¦å®š

   ä¸ªäººé…ç½®:
   .claude/mcp.json (ä¸æäº¤)
   â””â”€ ä¸ªäººå‡­è¯å’Œåå¥½

2. å…±äº«ä»»åŠ¡åˆ—è¡¨
   å›¢é˜Ÿç¯å¢ƒå˜é‡:
   export CLAUDE_CODE_TASK_LIST_ID=team-project

   å·¥ä½œæµ:
   â”œâ”€ æˆå‘˜ A: è®¤é¢†ä»»åŠ¡ 1
   â”œâ”€ æˆå‘˜ B: è®¤é¢†ä»»åŠ¡ 2
   â””â”€ å®æ—¶åŒæ­¥è¿›åº¦

3. ä»£ç å®¡æŸ¥é›†æˆ
   Skill: /review

   CLAUDE_CODE_TEAM_REVIEW=true
   â†’ è‡ªåŠ¨æ ‡è®°éœ€è¦å®¡æŸ¥çš„æ–‡ä»¶
   â†’ åˆ›å»º GitHub PR
   â†’ é€šçŸ¥å›¢é˜Ÿ

4. æ–‡æ¡£å³ä»£ç 
   CLAUDE.md ç»´æŠ¤:
   â”œâ”€ æ–°å†³ç­– â†’ æ·»åŠ  ADR
   â”œâ”€ æ–°æ¨¡å¼ â†’ æ›´æ–°ä»£ç è§„èŒƒ
   â””â”€ å®šæœŸå®¡æŸ¥è¿‡æœŸå†…å®¹

5. Skill å…±äº«
   .claude/skills/team/
   â”œâ”€ code-review/
   â”œâ”€ deploy/
   â””â”€ test/

   å›¢é˜Ÿæˆå‘˜éƒ½å¯ä½¿ç”¨:
   /code-review
   /deploy staging
```

---

## 8.5 å®‰å…¨æ€§

### å®‰å…¨æœ€ä½³å®è·µ

```
ä¼ä¸šçº§å®‰å…¨é…ç½®:

âœ… æ¨èåšæ³•:

1. æ•æ„Ÿä¿¡æ¯ä¿æŠ¤
   .gitignore:
   ```
   .claude/mcp.json      # æœ¬åœ°å‡­è¯
   .claude/logs/         # æ—¥å¿—å¯èƒ½å«æ•æ„Ÿä¿¡æ¯
   .claude/cache/        # ç¼“å­˜
   .env                  # ç¯å¢ƒå˜é‡
   .env.*               # æ‰€æœ‰ç¯å¢ƒæ–‡ä»¶
   ```

   ä½¿ç”¨ç¯å¢ƒå˜é‡:
   .claude-config.json:
   ```json
   {
     "mcpServers": {
       "database": {
         "env": {
           "DB_URL": "${DATABASE_URL}"  // ä»ç¯å¢ƒè¯»å–
         }
       }
     }
   }
   ```

2. å‘½ä»¤ç™½åå•
   .claude/config.json:
   ```json
   {
     "security": {
       "bashWhitelist": {
         "enabled": true,
         "patterns": [
           "npm run *",
           "git (status|diff|log|show)",
           "docker-compose (up|down|logs)",
           "kubectl get *"
         ]
       },
       "bashBlacklist": {
         "patterns": [
           "rm -rf /",
           "dd if=*",
           "> /dev/sd*",
           ":(){ :|:& };:"  // Fork bomb
         ]
       }
     }
   }
   ```

3. æƒé™åˆ†çº§
   å¼€å‘è€…è§’è‰²:
   ```json
   {
     "role": "developer",
     "permissions": {
       "file": ["read", "write"],
       "bash": ["safe-commands"],
       "git": ["commit", "push-branch"],
       "deploy": ["staging"]
     }
   }
   ```

   ç®¡ç†å‘˜è§’è‰²:
   ```json
   {
     "role": "admin",
     "permissions": {
       "file": ["read", "write", "delete"],
       "bash": ["all"],
       "git": ["all"],
       "deploy": ["staging", "production"]
     }
   }
   ```

4. å®¡è®¡å’Œåˆè§„
   å¯ç”¨å®Œæ•´å®¡è®¡:
   {
     "audit": {
       "enabled": true,
       "logPath": ".claude/audit/",
       "retention": "90days",
       "encrypt": true
     }
   }

   å®šæœŸå®¡æŸ¥:
   - æ¯å‘¨: æ£€æŸ¥å¼‚å¸¸å‘½ä»¤
   - æ¯æœˆ: æƒé™å®¡æŸ¥
   - æ¯å­£: å®‰å…¨è¯„ä¼°

5. ç½‘ç»œéš”ç¦»
   MCP æœåŠ¡å™¨é™åˆ¶:
   {
     "mcpServers": {
       "internal-api": {
         "network": {
           "allowedHosts": ["*.internal.company.com"],
           "blockedHosts": ["*"],
           "requireTLS": true
         }
       }
     }
   }
```

---

## æ€»ç»“

### æ ¸å¿ƒåŸåˆ™

1. **æœ€å°æƒé™**: ä»…æˆäºˆå¿…è¦çš„æƒé™
2. **å¹¶è¡Œä¼˜å…ˆ**: å……åˆ†åˆ©ç”¨å¤šä»£ç†èƒ½åŠ›
3. **æŒä¹…åŒ–**: ä¿å­˜é‡è¦ä¸Šä¸‹æ–‡å’Œä»»åŠ¡
4. **è‡ªåŠ¨åŒ–**: ä½¿ç”¨ Hook å’Œ Skills
5. **å¯è§‚æµ‹æ€§**: æ—¥å¿—ã€ç›‘æ§ã€å‘Šè­¦
6. **å®‰å…¨ç¬¬ä¸€**: ä¿æŠ¤æ•æ„Ÿä¿¡æ¯å’Œç³»ç»Ÿ

### å¿«é€Ÿæ£€æŸ¥æ¸…å•

è®¾ç½®æ–°é¡¹ç›®æ—¶:
- [ ] åˆ›å»º .claude-config.json (å›¢é˜Ÿé…ç½®)
- [ ] åˆ›å»º CLAUDE.md (é¡¹ç›®ä¸Šä¸‹æ–‡)
- [ ] é…ç½® Hook (è´¨é‡æ£€æŸ¥)
- [ ] è®¾ç½®æƒé™ç­–ç•¥
- [ ] é…ç½® MCP æœåŠ¡å™¨ (å¦‚éœ€è¦)
- [ ] åˆ›å»º Skills (å¸¸ç”¨æ“ä½œ)
- [ ] è®¾ç½®å®¡è®¡æ—¥å¿—
- [ ] æ·»åŠ  .gitignore è§„åˆ™

æ—¥å¸¸å¼€å‘:
- [ ] ä½¿ç”¨ /plan å¤„ç†å¤æ‚ä»»åŠ¡
- [ ] å®šæœŸ /compact å‹ç¼©ä¸Šä¸‹æ–‡
- [ ] åˆ©ç”¨ä»»åŠ¡ç³»ç»Ÿè·¨ä¼šè¯åä½œ
- [ ] å®¡æŸ¥ Hook æ—¥å¿—
- [ ] æ›´æ–° CLAUDE.md

---

## ä¸‹ä¸€æ­¥

- å‚è€ƒ [å‚è€ƒèµ„æº](./09-references.md)ï¼Œæ·±å…¥å­¦ä¹ ç‰¹å®šä¸»é¢˜
- æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£è·å–æœ€æ–°ç‰¹æ€§

---

**æŒç»­æ”¹è¿›**: æœ€ä½³å®è·µä¼šéšç€ Claude Code æ¼”è¿›è€Œæ›´æ–°ï¼Œå»ºè®®å®šæœŸæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚
